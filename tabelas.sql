-- Tabela base (classe abstrata)
CREATE TABLE AGENDAMENTOS (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PACIENTE VARCHAR2(100) NOT NULL,
    MEDICO VARCHAR2(100) NOT NULL,
    DATA_HORA TIMESTAMP NOT NULL,
    NOME_CONSULTA VARCHAR2(100),
    NOME_PROFISSIONAL VARCHAR2(100),
    TIPO VARCHAR2(20) NOT NULL  -- 'ONLINE' ou 'PRESENCIAL'
);

-- Tabela filha: Agendamento Presencial
CREATE TABLE AGENDAMENTO_PRESENCIAL (
    ID NUMBER PRIMARY KEY,
    ENDERECO VARCHAR2(255) NOT NULL,
    CONSTRAINT FK_PRESENCIAL_AGEND FOREIGN KEY (ID)
        REFERENCES AGENDAMENTOS(ID)
        ON DELETE CASCADE
);

-- Tabela filha: Agendamento Online
CREATE TABLE AGENDAMENTO_ONLINE (
    ID NUMBER PRIMARY KEY,
    LINK VARCHAR2(255) NOT NULL,
    CONSTRAINT FK_ONLINE_AGEND FOREIGN KEY (ID)
        REFERENCES AGENDAMENTOS(ID)
        ON DELETE CASCADE
);

CREATE TABLE EXAME (
    ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    RESULTADO_EXAME VARCHAR2(255),
    TIPO VARCHAR2(100) NOT NULL,
    DIA_HORA TIMESTAMP NOT NULL
);

-- TABELA LOGIN_SENHA
CREATE TABLE login_senha (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    email VARCHAR2(100) NOT NULL UNIQUE,
    senha VARCHAR2(100) NOT NULL
);

-- TABELA PACIENTE
CREATE TABLE paciente (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nome VARCHAR2(100) NOT NULL,
    cpf VARCHAR2(14) UNIQUE NOT NULL,
    data_nascimento DATE,
    telefone VARCHAR2(20),
    id_login NUMBER NOT NULL,
    CONSTRAINT fk_paciente_login
        FOREIGN KEY (id_login)
        REFERENCES login_senha(id)
        ON DELETE CASCADE
);

-- EXAME (ligado ao paciente)
CREATE TABLE exame (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    resultado_exame VARCHAR2(500),
    tipo VARCHAR2(100),
    dia_hora TIMESTAMP,
    id_paciente NUMBER NOT NULL,
    CONSTRAINT fk_exame_paciente
        FOREIGN KEY (id_paciente)
        REFERENCES paciente(id)
        ON DELETE CASCADE
);

-- AGENDAMENTOS (classe base abstrata)
CREATE TABLE agendamentos (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    paciente_id NUMBER NOT NULL,
    medico VARCHAR2(100),
    data_hora TIMESTAMP,
    nome_consulta VARCHAR2(100),
    nome_profissional VARCHAR2(100),
    tipo_agendamento VARCHAR2(20) NOT NULL,
    CONSTRAINT fk_agendamento_paciente
        FOREIGN KEY (paciente_id)
        REFERENCES paciente(id)
        ON DELETE CASCADE
);

-- AGENDAMENTO PRESENCIAL (herda de agendamentos)
CREATE TABLE agendamento_presencial (
    id NUMBER PRIMARY KEY,
    endereco VARCHAR2(200) NOT NULL,
    CONSTRAINT fk_presencial_agendamento
        FOREIGN KEY (id)
        REFERENCES agendamentos(id)
        ON DELETE CASCADE
);

-- AGENDAMENTO ONLINE (herda de agendamentos)
CREATE TABLE agendamento_online (
    id NUMBER PRIMARY KEY,
    link VARCHAR2(300) NOT NULL,
    CONSTRAINT fk_online_agendamento
        FOREIGN KEY (id)
        REFERENCES agendamentos(id)
        ON DELETE CASCADE
);

